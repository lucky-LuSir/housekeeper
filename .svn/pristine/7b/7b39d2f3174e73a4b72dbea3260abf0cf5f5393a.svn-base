<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kfwy.hkp.sys.user.entity.UserEntity">

    <resultMap id="BaseResultMap" type="com.kfwy.hkp.sys.user.entity.UserEntity">
        <result column="id" property="id" jdbcType="NUMERIC" javaType="long"/>
        <result column="user_code" property="userCode" jdbcType="VARCHAR"/>
        <result column="user_name" property="userName" jdbcType="VARCHAR"/>
        <result column="user_phone" property="userPhone" jdbcType="VARCHAR"/>
        <result column="user_img" property="userImg" jdbcType="VARCHAR"/>
        <result column="user_type" property="userType" jdbcType="VARCHAR"/>
        <result column="invite_state" property="inviteState" jdbcType="VARCHAR"/>
        <result column="work_number" property="workNumber" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="sex" property="sex" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="secure" property="secure"/>
        <result column="owner_dept_code" property="ownerDeptCode"/>
        <result column="owner_dept_name" property="ownerDeptName"/>
        <result column="has_manager" property="hasManager" jdbcType="BOOLEAN"/>
        <result column="enter_type" property="enterType" />
        <result column="leader_code" property="leaderCode" />
        <result column="leader_name" property="leaderName" />
        <result column="emp_post_code" property="empPostCode"/>
        <result column="emp_post_name" property="empPostName"/>
        <result column="entry_time" property="entryTime" jdbcType="TIMESTAMP"/>
        <result column="quit_time" property="quitTime" jdbcType="TIMESTAMP"/>
        <result column="user_ca_status" property="userCAStatus" jdbcType="VARCHAR"/>
        <result column="card" property="card" jdbcType="VARCHAR"/>
        <result column="device_token" property="deviceToken"/>
        <result column="need_auth" property="needAuth" jdbcType="BOOLEAN"/>
        <result column="identify_number" property="identifyNumber" jdbcType="VARCHAR"/>
        <result column="device_brand" property="deviceBrand" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="cpy_code" property="cpyCode" jdbcType="VARCHAR"/>
        <result column="create_code" property="createCode" jdbcType="VARCHAR"/>
        <result column="create_dept_code" property="createDeptCode" jdbcType="VARCHAR"/>
        <result column="last_update_code" property="lastUpdateCode" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="last_update_time" property="lastUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="is_deleted" property="isDeleted" jdbcType="BOOLEAN"/>
        <result column="card" property="card" jdbcType="VARCHAR"/>
        <result column="card_image_name" property="cardImageName" jdbcType="VARCHAR"/>
        <result column="bank_card_image_name" property="bankCardImageName" jdbcType="VARCHAR"/>
        <result column="user_level" property="userLevel" jdbcType="VARCHAR"/>
        <!--薪资方案，推荐人字段-->
        <result column="is_referrer" property="hasReferrer" jdbcType="BOOLEAN"/>
        <result column="referrer_code" property="referrerCode" jdbcType="VARCHAR"/>
        <result column="salary_type" property="salaryType" jdbcType="VARCHAR"/>
        <result column="has_pass" property="hasPass" jdbcType="VARCHAR"/>

        <result column="in_dept_team_time" property="inDeptTeamTime" jdbcType="TIMESTAMP"/>
        <result column="group_name" property="groupName" jdbcType="VARCHAR"/>
        <result column="pay_status" property="payStatus"/>
        <result column="inviter_code" property="inviterCode"/>
        <result column="inviter" property="inviter"/>
        <result column="can_get_activation_code" property="canGetActivationCode"/>

        <result column="is_frost" property="isFrost" jdbcType="BOOLEAN"/>

        <collection property="userRole" ofType="com.kfwy.hkp.sys.auth.entity.RoleEntity"
                    columnPrefix="ro_" resultMap="userRoleResultMap"/>

        <collection property="deptAreas" ofType="com.kfwy.hkp.hrm.org.dept.entity.DeptAreaEntity"
                    columnPrefix="da_" resultMap="deptAreaResultMap"/>

        <collection property="userAreas" ofType="com.kfwy.hkp.sys.user.entity.UserAreaEntity"
                    columnPrefix="ua_" resultMap="userAreaResultMap"/>
    </resultMap>

    <resultMap id="userRoleResultMap" type="com.kfwy.hkp.sys.auth.entity.RoleEntity">
        <result column="ID" property="id" jdbcType="NUMERIC" javaType="long"/>
        <result column="cpy_code" property="cpyCode" jdbcType="VARCHAR"/>
        <result column="role_code" property="roleCode" jdbcType="VARCHAR"/>
        <result column="role_name" property="roleName" jdbcType="VARCHAR"/>
        <result column="user_code" property="userCode" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="is_deleted" property="isDeleted" jdbcType="BOOLEAN"/>
        <result column="create_code" property="createCode" jdbcType="VARCHAR"/>
        <result column="create_name" property="createName" jdbcType="VARCHAR"/>
        <result column="last_update_code" property="lastUpdateCode" jdbcType="VARCHAR"/>
        <result column="last_update_name" property="lastUpdateName" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="last_update_time" property="lastUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="is_deleted" property="isDeleted" jdbcType="BOOLEAN"/>
    </resultMap>
    <resultMap id="deptAreaResultMap" type="com.kfwy.hkp.hrm.org.dept.entity.DeptAreaEntity">
        <result column="ID" property="id" jdbcType="NUMERIC" javaType="long"/>
        <result column="dept_code" property="deptCode" jdbcType="VARCHAR"/>
        <result column="province_code" property="provinceCode" jdbcType="VARCHAR"/>
        <result column="province_name" property="provinceName" jdbcType="VARCHAR"/>
        <result column="city_code" property="cityCode" jdbcType="VARCHAR"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="region_code" property="regionCode" jdbcType="VARCHAR"/>
        <result column="region_name" property="regionName" jdbcType="VARCHAR"/>

        <result column="street_code" property="streetCode" jdbcType="VARCHAR"/>
        <result column="street_name" property="streetName" jdbcType="VARCHAR"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="LAST_UPDATE_TIME" property="lastUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="IS_DELETED" property="isDeleted" jdbcType="BOOLEAN"/>
    </resultMap>

    <resultMap id="userAreaResultMap" type="com.kfwy.hkp.sys.user.entity.UserAreaEntity">
        <result column="ID" property="id" jdbcType="NUMERIC" javaType="long"/>
        <result column="user_code" property="userCode" jdbcType="VARCHAR"/>
        <result column="province_code" property="provinceCode" jdbcType="VARCHAR"/>
        <result column="province_name" property="provinceName" jdbcType="VARCHAR"/>
        <result column="city_code" property="cityCode" jdbcType="VARCHAR"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="region_code" property="regionCode" jdbcType="VARCHAR"/>
        <result column="region_name" property="regionName" jdbcType="VARCHAR"/>

        <result column="street_code" property="streetCode" jdbcType="VARCHAR"/>
        <result column="street_name" property="streetName" jdbcType="VARCHAR"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="LAST_UPDATE_TIME" property="lastUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="IS_DELETED" property="isDeleted" jdbcType="BOOLEAN"/>
    </resultMap>

    <!--根据独立经纪人code 获取其信息-->
    <select id="getUserEntity" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
            u.*,
            a.province_code AS ua_province_code,
            a.province_name AS ua_province_name,
            a.city_code     AS ua_city_code,
            a.city_name     AS ua_city_name,
            a.region_code   AS ua_region_code,
            a.region_name   AS ua_region_name,
            a.street_code   AS ua_street_code,
            a.street_name   AS ua_street_name
        FROM t_hkp_sys_user_user u, t_hkp_sys_user_user_area a
        WHERE a.user_code = u.user_code
              AND u.user_code = #{userCode}
    </select>
    <!-- 批量新增信息到数据库中 -->
    <insert id="batchInsert" parameterType="java.util.List">
        <foreach collection="list" item="i" separator=";">
            INSERT INTO t_hkp_sys_user_user
            <trim prefix="(" suffix=")" suffixOverrides=",">
                <if test="i.userCode != null and i.userCode != ''">
                    user_code,
                </if>
                <if test="i.userName != null and i.userName != ''">
                    user_name,
                </if>
                <if test="i.userPhone != null and i.userPhone !=''">
                    user_phone,
                </if>
                <if test="i.userImg != null and i.userImg !=''">
                    user_img,
                </if>
                <if test="i.userType != null and i.userType !=''">
                    user_type,
                </if>

                <if test="i.inviteState != null and i.inviteState !=''">
                    invite_state,
                </if>
                <if test="i.workNumber != null and i.workNumber !=''">
                    work_number,
                </if>
                <if test="i.email != null and i.email !=''">
                    email,
                </if>
                <if test="i.sex != null and i.sex != ''">
                    sex,
                </if>
                <if test="i.password != null and i.password != ''">
                    password,
                </if>
                <if test="i.secure != null">
                    secure,
                </if>

                <if test="i.ownerDeptCode != null and i.ownerDeptCode != ''">
                    owner_dept_code,
                </if>
                <if test="i.ownerDeptName != null and i.ownerDeptName != ''">
                    owner_dept_name,
                </if>
                <if test="i.hasManager != null">
                    has_manager,
                </if>
                <if test="i.enterType != null and i.enterType != ''">
                    enter_type,
                </if>
                <if test="i.leaderCode != null and i.leaderCode != ''">
                    leader_code,
                </if>
                <if test="i.leaderName != null and i.leaderName != ''">
                    leader_name,
                </if>
                <if test="i.empPostCode != null and i.empPostCode != ''">
                    emp_post_code,
                </if>
                <if test="i.empPostName != null and i.empPostName != ''">
                    emp_post_name,
                </if>
                <if test="i.entryTime != null">
                    entry_time,
                </if>
                <if test="i.quitTime != null">
                    quit_time,
                </if>
                <if test="i.userCAStatus != null and i.userCAStatus != ''">
                    user_ca_status,
                </if>
                <if test="i.card != null and i.card != ''">
                    card,
                </if>
                <if test="i.deviceToken != null">
                    device_token,
                </if>
                <if test="i.needAuth != null">
                    need_auth,
                </if>
                <if test="i.identifyNumber != null">
                    identify_number,
                </if>
                <if test="i.deviceBrand !=null and i.deviceBrand!=''">
                    device_brand,
                </if>
                <if test="i.remark != null and i.remark!=''">
                    remark,
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    cpy_code,
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    create_code,
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    create_dept_code,
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    last_update_code,
                </if>
                <if test="i.createTime != null">
                    create_time,
                </if>
                <if test="i.lastUpdateTime != null">
                    last_update_time,
                </if>
                <if test="i.isDeleted != null">
                    is_deleted,
                </if>

                <if test="i.cardImageName != null">
                    card_image_name,
                </if>
                <if test="i.bankCardImageName != null">
                    bank_card_image_name,
                </if>
                <if test="i.userLevel!=null">
                    user_level,
                </if>
                <if test="i.hasReferrer != null">
                    is_referrer,
                </if>
                <if test="i.referrerCode != null and i.referrerCode != ''">
                    referrer_code,
                </if>
                <if test="i.salaryType !=null and i.salaryType!=''">
                    salary_type,
                </if>
                <if test="i.hasPass !=null and i.hasPass!=''">
                    has_pass,
                </if>
                <if test="i.groupName !=null and i.groupName!=''">
                    group_name,
                </if>
                <if test="i.inviterCode!=null and i.inviterCode!=''">
                    inviter_code,
                </if>
                <if test="i.inviter!=null and i.inviter!=''">
                    inviter,
                </if>
                <if test="i.payStatus!=null">
                    pay_status,
                </if>
                <if test="i.canGetActivationCode!=null">
                    can_get_activation_code,
                </if>
                <if test="i.isFrost!=null">
                    is_frost,
                </if>

                <if test="i.teacherCode!=null and i.teacherCode!=''">
                    teacher_code,
                </if>
                <if test="i.teacherName!=null and i.teacherName!=''">
                    teacher_name,
                </if>
            </trim>
            <trim prefix="values (" suffix=")" suffixOverrides=",">
                <if test="i.userCode != null and i.userCode != ''">
                    #{i.userCode},
                </if>
                <if test="i.userName != null and i.userName != ''">
                    #{i.userName},
                </if>
                <if test="i.userPhone != null and i.userPhone !=''">
                    #{i.userPhone},
                </if>
                <if test="i.userImg != null and i.userImg !=''">
                    #{i.userImg},
                </if>
                <if test="i.userType != null and i.userType !=''">
                    #{i.userType},
                </if>

                <if test="i.inviteState != null and i.inviteState !=''">
                    #{i.inviteState},
                </if>
                <if test="i.workNumber != null and i.workNumber !=''">
                    #{i.workNumber},
                </if>
                <if test="i.email != null and i.email !=''">
                    #{i.email},
                </if>
                <if test="i.sex != null and i.sex != ''">
                    #{i.sex},
                </if>
                <if test="i.password != null and i.password != ''">
                    #{i.password},
                </if>
                <if test="i.secure != null">
                    #{i.secure},
                </if>

                <if test="i.ownerDeptCode != null and i.ownerDeptCode != ''">
                    #{i.ownerDeptCode},
                </if>
                <if test="i.ownerDeptName != null and i.ownerDeptName != ''">
                    #{i.ownerDeptName},
                </if>
                <if test="i.hasManager != null">
                    #{i.hasManager},
                </if>
                <if test="i.enterType != null and i.enterType != ''">
                    #{i.enterType},
                </if>
                <if test="i.leaderCode != null and i.leaderCode != ''">
                    #{i.leaderCode},
                </if>
                <if test="i.leaderName != null and i.leaderName != ''">
                    #{i.leaderName},
                </if>
                <if test="i.empPostCode != null and i.empPostCode != ''">
                    #{i.empPostCode},
                </if>
                <if test="i.empPostName != null and i.empPostName != ''">
                    #{i.empPostName},
                </if>
                <if test="i.entryTime != null">
                    #{i.entryTime},
                </if>
                <if test="i.quitTime != null">
                    #{i.quitTime},
                </if>
                <if test="i.userCAStatus != null and i.userCAStatus != ''">
                    #{i.userCAStatus},
                </if>
                <if test="i.card != null and i.card != ''">
                    #{i.card},
                </if>
                <if test="i.deviceToken != null">
                    #{i.deviceToken},
                </if>
                <if test="i.needAuth != null">
                    #{i.needAuth},
                </if>
                <if test="i.identifyNumber != null">
                    #{i.identifyNumber},
                </if>
                <if test="i.deviceBrand !=null and i.deviceBrand !=''">
                    #{i.deviceBrand},
                </if>
                <if test="i.remark != null and i.remark!=''">
                    #{i.remark},
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    #{i.cpyCode},
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    #{i.createCode},
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    #{i.createDeptCode},
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    #{i.lastUpdateCode},
                </if>
                <if test="i.createTime != null">
                    #{i.createTime},
                </if>
                <if test="i.lastUpdateTime != null">
                    #{i.lastUpdateTime},
                </if>
                <if test="i.isDeleted != null">
                    #{i.isDeleted},
                </if>

                <if test="i.cardImageName != null">
                    #{i.cardImageName},
                </if>
                <if test="i.bankCardImageName != null">
                    #{i.bankCardImageName},
                </if>
                <if test="i.userLevel!=null">
                    #{i.userLevel},
                </if>
                <if test="i.hasReferrer != null">
                    #{i.hasReferrer},
                </if>
                <if test="i.referrerCode != null and i.referrerCode != ''">
                    #{i.referrerCode},
                </if>
                <if test="i.salaryType !=null and i.salaryType!=''">
                    #{i.salaryType},
                </if>
                <if test="i.hasPass !=null and i.hasPass!=''">
                    #{i.hasPass},
                </if>
                <if test="i.groupName !=null and i.groupName!=''">
                    #{i.groupName},
                </if>
                <if test="i.inviterCode!=null and i.inviterCode!=''">
                    #{i.inviterCode},
                </if>
                <if test="i.inviter!=null and i.inviter!=''">
                    #{i.inviter},
                </if>
                <if test="i.payStatus!=null">
                    #{i.payStatus},
                </if>
                <if test="i.canGetActivationCode!=null">
                    #{i.canGetActivationCode},
                </if>
                <if test="i.isFrost!=null">
                    #{i.isFrost},
                </if>

                <if test="i.teacherCode!=null and i.teacherCode!=''">
                    #{i.teacherCode},
                </if>
                <if test="i.teacherName!=null and i.teacherName!=''">
                    #{i.teacherName},
                </if>
            </trim>
        </foreach>
    </insert>
    <insert id="insert" parameterType="com.kfwy.hkp.sys.user.entity.UserEntity"
            useGeneratedKeys="true"
            keyProperty="id">
        INSERT INTO t_hkp_sys_user_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userCode != null and userCode != ''">
                user_code,
            </if>
            <if test="userName != null and userName != ''">
                user_name,
            </if>
            <if test="userPhone != null and userPhone != ''">
                user_phone,
            </if>
            <if test="userImg != null and userImg != ''">
                user_img,
            </if>
            <if test="userType != null and userType != ''">
                user_type,
            </if>


            <if test="inviteState != null and inviteState != ''">
                invite_state,
            </if>
            <if test="workNumber != null and workNumber != ''">
                work_number,
            </if>
            <if test="email != null and email != ''">
                email,
            </if>
            <if test="sex != null and sex != ''">
                sex,
            </if>
            <if test="password != null and password != ''">
                password,
            </if>

            <if test="secure != null and secure != ''">
                secure,
            </if>
            <if test="ownerDeptCode != null and ownerDeptCode != ''">
                owner_dept_code,
            </if>
            <if test="ownerDeptName != null and ownerDeptName != ''">
                owner_dept_name,
            </if>
            <if test="hasManager != null">
                has_manager,
            </if>
            <if test="enterType != null and enterType != ''">
                enter_type,
            </if>
            <if test="leaderCode != null and leaderCode != ''">
                leader_code,
            </if>
            <if test="leaderName != null and leaderName != ''">
                leader_name,
            </if>
            <if test="empPostCode != null and empPostCode != ''">
                emp_post_code,
            </if>
            <if test="empPostName != null and empPostName != ''">
                emp_post_name,
            </if>
            <if test="entryTime != null">
                entry_time,
            </if>
            <if test="quitTime != null">
                quit_time,
            </if>
            <if test="userCAStatus != null and userCAStatus != ''">
                user_ca_status,
            </if>
            <if test="card != null and card != ''">
                card,
            </if>
            <if test="deviceToken != null and deviceToken != ''">
                device_token,
            </if>
            <if test="needAuth != null">
                need_auth,
            </if>
            <if test="identifyNumber != null and identifyNumber != ''">
                identify_number,
            </if>
            <if test="deviceBrand !=null and deviceBrand!=''">
                device_brand,
            </if>
            <if test="remark != null and remark != ''">
                remark,
            </if>
            <if test="cpyCode != null and cpyCode != ''">
                cpy_code,
            </if>
            <if test="createCode != null and createCode != ''">
                create_code,
            </if>
            <if test="createDeptCode != null and createDeptCode != ''">
                create_dept_code,
            </if>
            <if test="lastUpdateCode != null and lastUpdateCode != ''">
                last_update_code,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="lastUpdateTime != null">
                last_update_time,
            </if>
            <if test="isDeleted != null">
                is_deleted,
            </if>

            <if test="cardImageName != null">
                card_image_name,
            </if>
            <if test="bankCardImageName != null">
                bank_card_image_name,
            </if>
            <if test="userLevel!=null">
                user_level,
            </if>
            <if test="hasReferrer != null">
                is_referrer,
            </if>
            <if test="referrerCode != null and referrerCode != ''">
                referrer_code,
            </if>
            <if test="salaryType !=null and salaryType!=''">
                salary_type,
            </if>
            <if test="hasPass !=null and hasPass!=''">
                has_pass,
            </if>
            <if test="groupName !=null and groupName!=''">
                group_name,
            </if>
            <if test="payStatus !=null and payStatus!=''">
                pay_status,
            </if>
            <if test="inviterCode!=null and inviterCode!=''">
                inviter_code,
            </if>
            <if test="inviter!=null and inviter!=''">
                inviter,
            </if>
            <if test="canGetActivationCode!=null">
                can_get_activation_code,
            </if>
            <if test="isFrost!=null">
                is_frost,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="userCode != null and userCode != ''">
                #{userCode},
            </if>
            <if test="userName != null and userName != ''">
                #{userName},
            </if>
            <if test="userPhone != null and userPhone != ''">
                #{userPhone},
            </if>
            <if test="userImg != null and userImg != ''">
                #{userImg},
            </if>
            <if test="userType != null and userType != ''">
                #{userType},
            </if>


            <if test="inviteState != null and inviteState != ''">
                #{inviteState},
            </if>
            <if test="workNumber != null and workNumber != ''">
                #{workNumber},
            </if>
            <if test="email != null and email != ''">
                #{email},
            </if>
            <if test="sex != null and sex != ''">
                #{sex},
            </if>
            <if test="password != null and password != ''">
                #{password},
            </if>

            <if test="secure != null and secure != ''">
                #{secure},
            </if>
            <if test="ownerDeptCode != null and ownerDeptCode != ''">
                #{ownerDeptCode},
            </if>
            <if test="ownerDeptName != null and ownerDeptName != ''">
                #{ownerDeptName},
            </if>
            <if test="hasManager != null">
                #{hasManager},
            </if>
            <if test="enterType != null and enterType != ''">
                #{enterType},
            </if>
            <if test="leaderCode != null and leaderCode != ''">
                #{leaderCode},
            </if>
            <if test="leaderName != null and leaderName != ''">
                #{leaderName},
            </if>
            <if test="empPostCode != null and empPostCode != ''">
                #{empPostCode},
            </if>
            <if test="empPostName != null and empPostName != ''">
                #{empPostName},
            </if>
            <if test="entryTime != null">
                #{entryTime},
            </if>
            <if test="quitTime != null">
                #{quitTime},
            </if>
            <if test="userCAStatus != null and userCAStatus != ''">
                #{userCAStatus},
            </if>
            <if test="card != null and card != ''">
                #{card},
            </if>
            <if test="deviceToken != null and deviceToken != ''">
                #{deviceToken},
            </if>
            <if test="needAuth != null">
                #{needAuth},
            </if>
            <if test="identifyNumber != null and identifyNumber != ''">
                #{identifyNumber},
            </if>
            <if test="deviceBrand !=null and deviceBrand!=''">
                #{deviceBrand},
            </if>
            <if test="remark != null and remark != ''">
                #{remark},
            </if>
            <if test="cpyCode != null and cpyCode != ''">
                #{cpyCode},
            </if>
            <if test="createCode != null and createCode != ''">
                #{createCode},
            </if>
            <if test="createDeptCode != null and createDeptCode != ''">
                #{createDeptCode},
            </if>
            <if test="lastUpdateCode != null and lastUpdateCode != ''">
                #{lastUpdateCode},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="lastUpdateTime != null">
                #{lastUpdateTime},
            </if>
            <if test="isDeleted != null">
                #{isDeleted},
            </if>

            <if test="cardImageName != null">
                #{cardImageName},
            </if>
            <if test="bankCardImageName != null">
                #{bankCardImageName},
            </if>
            <if test="userLevel!=null">
                #{userLevel},
            </if>
            <if test="hasReferrer != null">
                #{hasReferrer},
            </if>
            <if test="referrerCode != null and referrerCode != ''">
                #{referrerCode},
            </if>
            <if test="salaryType !=null and salaryType!=''">
                #{salaryType},
            </if>
            <if test="hasPass !=null and hasPass!=''">
                #{hasPass},
            </if>

            <if test="groupName !=null and groupName!=''">
                #{groupName},
            </if>
            <if test="payStatus !=null and payStatus!=''">
                #{payStatus},
            </if>
            <if test="inviterCode!=null and inviterCode!=''">
                #{inviterCode},
            </if>
            <if test="inviter!=null and inviter!=''">
                #{inviter},
            </if>
            <if test="canGetActivationCode!=null">
                #{canGetActivationCode},
            </if>
            <if test="isFrost!=null">
                #{isFrost},
            </if>
        </trim>
    </insert>

    <!-- 批量更新数据信息 -->
    <update id="batchUpdate" parameterType="com.kfwy.hkp.sys.user.entity.UserEntity">
        <foreach collection="list" item="i" index="index" separator=";">
            UPDATE t_hkp_sys_user_user
            <trim prefix="set" suffixOverrides=",">
                <if test="i.userCode != null and i.userCode != ''">
                    user_code = #{i.userCode},
                </if>
                <if test="i.userName != null and i.userName != ''">
                    user_name = #{i.userName},
                </if>
                <if test="i.userPhone != null and i.userPhone !=''">
                    user_phone = #{i.userPhone},
                </if>
                <if test="i.userImg != null and i.userImg !=''">
                    user_img = #{i.userImg},
                </if>
                <if test="i.userType != null and i.userType !=''">
                    user_type = #{i.userType},
                </if>

                <if test="i.inviteState != null and i.inviteState !=''">
                    invite_state = #{i.inviteState},
                </if>
                <if test="i.workNumber != null and i.workNumber !=''">
                    work_number = #{i.workNumber},
                </if>
                <if test="i.email != null and i.email !=''">
                    email = #{i.email},
                </if>
                <if test="i.sex != null and i.sex != ''">
                    sex = #{i.sex},
                </if>
                <if test="i.password != null and i.password != ''">
                    password = #{i.password},
                </if>
                <if test="i.secure != null">
                    secure = #{i.secure},
                </if>

                <if test="i.ownerDeptCode != null and i.ownerDeptCode != ''">
                    owner_dept_code = #{i.ownerDeptCode},
                </if>
                <if test="i.ownerDeptName != null and i.ownerDeptName != ''">
                    owner_dept_name = #{i.ownerDeptName},
                </if>
                <if test="i.hasManager != null">
                    has_manager = #{i.hasManager},
                </if>
                <if test="i.enterType != null and i.enterType != ''">
                    enter_type = #{i.enterType},
                </if>
                <if test="i.leaderCode != null and i.leaderCode != ''">
                    leader_code = #{i.leaderCode},
                </if>
                <if test="i.leaderName != null and i.leaderName != ''">
                    leader_name = #{i.leaderName},
                </if>
                <if test="i.empPostCode != null and i.empPostCode != ''">
                    emp_post_code = #{i.empPostCode},
                </if>
                <if test="i.empPostName != null and i.empPostName != ''">
                    emp_post_name = #{i.empPostName},
                </if>
                <if test="i.entryTime != null">
                    entry_time = #{i.entryTime},
                </if>
                <if test="i.quitTime != null">
                    quit_time = #{i.quitTime},
                </if>
                <if test="i.userCAStatus != null and i.userCAStatus != ''">
                    user_ca_status = #{i.userCAStatus},
                </if>
                <if test="i.card != null and i.card != ''">
                    card = #{i.card},
                </if>
                <if test="i.deviceToken != null">
                    device_token = #{i.deviceToken},
                </if>
                <if test="i.needAuth != null">
                    need_auth = #{i.needAuth},
                </if>
                <if test="i.identifyNumber != null">
                    identify_number = #{i.identifyNumber},
                </if>
                <if test="i.deviceBrand !=null and i.deviceBrand !=''">
                    device_brand=#{i.deviceBrand},
                </if>
                <if test="i.remark != null and i.remark!=''">
                    remark = #{i.remark},
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    cpy_code = #{i.cpyCode},
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    create_code = #{i.createCode},
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    create_dept_code = #{i.createDeptCode},
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    last_update_code = #{i.lastUpdateCode},
                </if>
                <if test="i.createTime != null">
                    create_time = #{i.createTime},
                </if>
                <if test="i.lastUpdateTime != null">
                    last_update_time = #{i.lastUpdateTime},
                </if>
                <if test="i.isDeleted != null">
                    is_deleted = #{i.isDeleted},
                </if>
                <if test="i.cardImageName != null">
                    card_image_name = #{i.cardImageName},
                </if>
                <if test="i.bankCardImageName != null">
                    bank_card_image_name = #{i.bankCardImageName},
                </if>
                <if test="i.userLevel!=null">
                    user_level = #{i.userLevel},
                </if>
                <if test="i.hasReferrer != null">
                    is_referrer=#{i.hasReferrer},
                </if>
                <if test="i.referrerCode != null and i.referrerCode != ''">
                    referrer_code=#{i.referrerCode},
                </if>
                <if test="i.referrerCode == null or i.referrerCode == ''">
                    referrer_code=null,
                </if>
                <if test="i.salaryType !=null and i.salaryType!=''">
                    salary_type=#{i.salaryType},
                </if>
                <if test="i.hasPass !=null and i.hasPass!=''">
                    has_pass=#{i.hasPass},
                </if>
                <if test="i.groupName !=null and i.groupName!=''">
                    group_name=#{i.groupName},
                </if>
                <if test="i.payStatus !=null and i.payStatus!=''">
                    pay_status=#{i.payStatus},
                </if>
                <if test="i.inviterCode!=null and i.inviterCode!=''">
                    inviter_code=#{i.inviterCode},
                </if>
                <if test="i.inviter!=null and i.inviter!=''">
                    inviter = #{i.inviter},
                </if>
                <if test="i.canGetActivationCode!=null">
                    can_get_activation_code = #{i.canGetActivationCode},
                </if>
                <if test="i.isFrost!=null">
                    is_frost = #{i.isFrost},
                </if>

                <if test="i.teacherCode !=null and i.teacherCode !=''">
                    teacher_code =  #{i.teacherCode},
                </if>
                <if test="i.teacherName !=null and i.teacherName !=''">
                    teacher_name =  #{i.teacherName},
                </if>

            </trim>
            <trim prefix="where" prefixOverrides="AND|OR">
                user_code = #{i.userCode}
            </trim>
        </foreach>
    </update>

    <!-- 通过主键批量物理删除数据 -->
    <delete id="batchDeletedByIds" parameterType="java.util.List">
        DELETE FROM t_hkp_sys_user_user WHERE ID IN
        <foreach collection="list" item="i" open="(" separator="," close=")">
            #{i}
        </foreach>
    </delete>

    <!--执行本地更新 -->
    <update id="updateByNativeSql" parameterType="string">
        ${value}
    </update>

    <!-- 根据原生Sql查询记录 -->
    <select id="selectByNativeSql" parameterType="string" resultMap="BaseResultMap">
        ${value}
    </select>

    <!-- 根据原生SQL查询单条记录-->
    <select id="selectOneByNativeSql" parameterType="string" resultMap="BaseResultMap">
        ${value}
    </select>

    <!-- 根据原生Sql统计数量 -->
    <select id="countByNativeSql" parameterType="string" resultType="int">
        ${value}
    </select>

    <!-- 通用脚本查询条件 -->
    <sql id="selectSql">
        <trim prefix="where" prefixOverrides="AND|OR">
            <if test="keyword != null and keyword != ''">
                AND
                (
                user_name LIKE '%' || #{keyword} ||'%' OR
                work_number LIKE '%' || #{keyword} ||'%' OR
                user_phone LIKE '%' || #{keyword} ||'%' OR
                owner_dept_name LIKE '%' || #{keyword} ||'%' OR
                emp_post_name LIKE '%' || #{keyword} ||'%'
                )
            </if>
            <if test="id != null">
                AND ID = #{id}
            </if>
            <if test="userName !=null and userName !=''">
                AND user_name LIKE '%' || #{userName} ||'%'
            </if>
            <if test="userCode != null and userCode !=''">
                AND user_code = #{userCode}
            </if>
            <if test="workNumber != null and workNumber !=''">
                AND work_number = #{workNumber}
            </if>
            <if test="userPhone != null and userPhone !=''">
                AND user_phone = #{userPhone}
            </if>
            <if test="userType != null and userType !=''">
                AND user_type = #{userType}
            </if>
            <if test="userTypes != null and userTypes !=''">
                AND user_type IN ('JoinStaff','Employee')
            </if>

            <if test="inviteState != null and inviteState !=''">
                AND invite_state = #{inviteState}
            </if>
            <if test="deviceToken != null and deviceToken !=''">
                AND device_token = #{deviceToken}
            </if>
            <!-- codes 和 _codes 二选一条件-->
            <if test="userCodes != null">
                AND user_code IN
                <foreach collection="userCodes" item="i" open="(" separator="," close=")">
                    #{i}
                </foreach>
            </if>
            <if test="_userCodes != null">
                AND user_code IN (${_userCodes})
            </if>
            <if test="email != null and email !=''">
                AND email = #{email}
            </if>
            <if test="sex != null and sex !=''">
                AND sex = #{sex}
            </if>
            <if test="password != null and password !=''">
                AND password = #{password}
            </if>
            <if test="remark != null and remark !=''">
                AND remark = #{remark}
            </if>
            <if test="isDeleted != null">
                AND is_deleted = #{isDeleted}
            </if>
            <if test="createTimeStart != null">
                AND create_time <![CDATA[ >= ]]> #{createTimeStart}
            </if>
            <if test="createTimeEnd != null">
                AND create_time <![CDATA[ <= ]]> #{createTimeEnd}
            </if>
            <if test="entryTimeStart != null">
                AND entry_time <![CDATA[ >= ]]> #{entryTimeStart}
            </if>
            <if test="entryTimeEnd != null">
                AND entry_time <![CDATA[ <= ]]> #{entryTimeEnd}
            </if>
            <if test="quitTimeStart != null">
                AND (quit_time <![CDATA[ >= ]]> #{quitTimeStart} or quit_time is null)
            </if>
            <if test="quitTimeEnd != null">
                AND (quit_time <![CDATA[ <= ]]> #{quitTimeEnd} or quit_time is null)
            </if>
            <if test="empPostCode !=null and empPostCode!=''">
                AND emp_post_code =#{empPostCode}
            </if>
            <if test="ownerDeptCode !=null and ownerDeptCode!=''">
                AND owner_dept_code =#{ownerDeptCode}
            </if>
            <if test="ownerDeptCodes != null and ownerDeptCodes.size() > 0">
                <choose>
                    <when test="_ownerDeptCodes != null">
                        AND owner_dept_code IN (${_ownerDeptCodes})
                    </when>
                    <otherwise>
                        AND owner_dept_code IN
                        <foreach collection="ownerDeptCodes" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="userLevel !=null">
                AND user_level =#{userLevel}
            </if>
            <if test="hasPass !=null">
                AND has_pass =#{hasPass}
            </if>
            <if test="canGetActivationCode!=null">
                AND can_get_activation_code = #{canGetActivationCode}
            </if>
            <if test="inviter !=null and inviter!=''">
                AND inviter = #{inviter}
            </if>
            <if test="inviterCode !=null and inviterCode!=''">
                AND inviter_code = #{inviterCode}
            </if>
            <if test="cpyCode != null and cpyCode != ''">
                AND cpy_code = #{cpyCode}
            </if>
        </trim>
    </sql>

    <sql id="area">
        <choose>
            <when test="street !=null">
                AND a.street_code=#{street}
            </when>
            <when test="region != null">
                AND a.region_code = #{region}
            </when>
            <when test="city != null">
                AND a.city_code = #{city}
            </when>
            <when test="province != null">
                AND a.province_code =#{province}
            </when>
        </choose>
    </sql>

    <!-- 查询唯一的信息 -->
    <select id="selectUniqueByProp" parameterType="java.util.Map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.sys.user.entity.UserEntity">
        select *
        from t_hkp_sys_user_user
        <include refid="selectSql"/>
    </select>

    <!-- 通过指定条件查询信息总数，用于分页展示 -->
    <select id="countByMap" parameterType="java.util.Map" resultType="int">
        SELECT count(id) FROM t_hkp_sys_user_user
        <include refid="selectSql"/>
    </select>

    <!-- 只包含用户信息,无区域,无部门,无角色 -->
    <select id="selectSimpleUserByMap" parameterType="java.util.Map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.sys.user.entity.UserEntity">
        select * from t_hkp_sys_user_user
        <include refid="selectSql"/>
    </select>

    <!-- 查询符合条件的实体对象 -->
    <select id="selectUserCodeByMap" resultType="java.lang.String">
        SELECT user_code FROM t_hkp_sys_user_user
        <trim prefix="where" prefixOverrides="AND|OR">
            <if test="entryTimeStart != null">
                AND entry_time <![CDATA[ >= ]]> #{entryTimeStart}
            </if>
            <if test="entryTimeEnd != null">
                AND entry_time <![CDATA[ <= ]]> #{entryTimeEnd}
            </if>
            <if test="quitTimeStart != null">
                AND (quit_time <![CDATA[ >= ]]> #{quitTimeStart} or quit_time is null)
            </if>
            <if test="quitTimeEnd != null">
                AND (quit_time <![CDATA[ <= ]]> #{quitTimeEnd} or quit_time is null)
            </if>
            <if test="ownerDeptCode != null and ownerDeptCode != ''">
                AND owner_dept_code = #{ownerDeptCode}
            </if>
            <if test="ownerDeptCodes != null and ownerDeptCodes.size() > 0">
                <choose>
                    <when test="_ownerDeptCodes != null">
                        AND owner_dept_code IN (${_ownerDeptCodes})
                    </when>
                    <otherwise>
                        AND owner_dept_code IN
                        <foreach collection="ownerDeptCodes" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="isDeleted != null">
                AND is_deleted=#{isDeleted}
            </if>
        </trim>
    </select>
    <!-- 查询符合条件的实体对象 -->
    <select id="selectUserByDeptCodes"  parameterType="java.util.Map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.sys.user.entity.UserEntity">
        SELECT * FROM t_hkp_sys_user_user
        <trim prefix="where" prefixOverrides="AND|OR">
            <if test="entryTimeStart != null">
                AND entry_time <![CDATA[ >= ]]> #{entryTimeStart}
            </if>
            <if test="entryTimeEnd != null">
                AND entry_time <![CDATA[ <= ]]> #{entryTimeEnd}
            </if>
            <if test="quitTimeStart != null">
                AND (quit_time <![CDATA[ >= ]]> #{quitTimeStart} or quit_time is null)
            </if>
            <if test="quitTimeEnd != null">
                AND (quit_time <![CDATA[ <= ]]> #{quitTimeEnd} or quit_time is null)
            </if>
            <if test="ownerDeptCode != null and ownerDeptCode != ''">
                AND owner_dept_code = #{ownerDeptCode}
            </if>
            <if test="ownerDeptCodes != null and ownerDeptCodes.size() > 0">
                <choose>
                    <when test="_ownerDeptCodes != null">
                        AND owner_dept_code IN (${_ownerDeptCodes})
                    </when>
                    <otherwise>
                        AND owner_dept_code IN
                        <foreach collection="ownerDeptCodes" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="isDeleted != null">
                AND is_deleted=#{isDeleted}
            </if>
        </trim>
    </select>
    <!-- 通过指定条件查询信息，内部分页 -->
    <select id="selectByMap" parameterType="java.util.Map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.sys.user.entity.UserEntity">
        select * from (
        SELECT u.*,ua.user_code as ua_user_code,da.dept_code as da_dept_code,
        ua.province_code as ua_province_code ,ua.city_code as ua_city_code,
        ua.region_code as ua_region_code ,ua.street_code as ua_street_code,
        ua.province_name as ua_province_name ,ua.city_code as ua_city_name,
        ua.region_name as ua_region_name ,ua.street_name as ua_street_name,
        da.province_code as da_province_code ,da.city_code as da_city_code,
        da.region_code as da_region_code ,da.street_code as da_street_code,
        da.province_name as da_province_name ,da.city_name as da_city_name,
        da.region_name as da_region_name ,da.street_name as da_street_name
        FROM
        (
        select * from
        (
        select * from t_hkp_sys_user_user u
        where
        EXISTS
        (
        select * from t_hkp_sys_user_user_area a
        where a.user_code = u.user_code
        <include refid="area"/>
        )
        or
        EXISTS
        (
        select * from t_hkp_hrm_org_dept_area a
        where a.dept_code= u.owner_dept_code
        <include refid="area"/>
        )
        ) ut
        <include refid="selectSql"/>
        <if test="limit != null">
            limit #{limit}
        </if>
        <if test="offset != null">
            offset #{offset}
        </if>
        ) u
        left join t_hkp_sys_user_user_area ua on ua.user_code=u.user_code
        left join t_hkp_hrm_org_dept_area da on da.dept_code = u.owner_dept_code
        )D
        <include refid="selectSql"/>
        <if test="orderBy != null">
            ORDER BY ${orderBy}
        </if>
        <if test="order != null">
            ${order}
        </if>
    </select>

    <!-- 通过指定条件查询信息总数，用于分页展示 -->
    <select id="selectByMapCount" parameterType="map" resultType="int">
        SELECT count(*) FROM
        (
        select * from t_hkp_sys_user_user u
        where
        EXISTS
        (
        select * from t_hkp_sys_user_user_area a
        where a.user_code = u.user_code
        <include refid="area"/>
        )
        or
        EXISTS
        (
        select * from t_hkp_hrm_org_dept_area a
        where a.dept_code= u.owner_dept_code
        <include refid="area"/>
        )
        ) u
        <include refid="selectSql"/>
    </select>
    <!--包含部門。角色信息  无区域-->
    <select id="selectUserBasisInfoByMap" parameterType="java.util.Map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.sys.user.entity.UserEntity">
        select u.*,ro.role_code as ro_role_code,ar.role_name as ro_role_name,ro.user_code as
        ro_user_code
        from (
        select * from t_hkp_sys_user_user
        <include refid="selectSql"/>
        <if test="limit != null">
            limit #{limit}
        </if>
        <if test="offset != null">
            offset #{offset}
        </if>
        ) u left join t_hkp_sys_user_user_role ro on u.user_code=ro.user_code
        left join t_hkp_sys_auth_role ar on ro.role_code=ar.role_code
        order by u.work_number,u.user_code

    </select>
    <select id="selectUserBasisInfoByMapCount" parameterType="map" resultType="int">
        SELECT count(*) FROM
        t_hkp_sys_user_user
        <include refid="selectSql"/>
    </select>

    <update id="updateIdentifyNumber" parameterType="map">
        UPDATE t_hkp_sys_user_user
        SET identify_number = NULL
        WHERE user_phone = #{userPhone} AND user_code = #{userCode}
    </update>

    <select id="queryAllUser" resultMap="BaseResultMap">
        SELECT
            user_code,
            user_name,
            owner_dept_code,
            owner_dept_name
        FROM t_hkp_sys_user_user;
    </select>

    <select id="findUsersByDeptArea" parameterType="map" resultMap="BaseResultMap">
        SELECT * FROM t_hkp_sys_user_user us WHERE
        us.user_code IN (
        SELECT DISTINCT u.user_code
        FROM
        t_hkp_sys_user_user u
        INNER JOIN t_hkp_hrm_org_dept_area area ON u.owner_dept_code = area.dept_code
        <trim prefix="where" prefixOverrides="AND|OR">
            <if test="cusAreaString!=null">
                AND region_code in (${cusAreaString})
                AND u.is_deleted = FALSE
            </if>
            <if test="excludeByPostCodes!=null">
                AND u.emp_post_code not in (${excludeByPostCodes})
                AND u.is_deleted = FALSE
            </if>
            <if test="excludeUserCodesByFocusCusCount!=null">
                AND u.user_code not in (${excludeUserCodesByFocusCusCount})
                AND u.is_deleted = FALSE
            </if>
            <if test="excludeUserCodesByNoticeUsers!=null">
                AND u.user_code not in(${excludeUserCodesByNoticeUsers})
                AND u.is_deleted = FALSE
            </if>
            <if test="excludeUserCodesByBlackList !=null">
                AND u.user_code not in (${excludeUserCodesByBlackList})
                AND u.is_deleted = FALSE
            </if>
        </trim>
        )
    </select>

    <select id="findUsersByNoticeDepts" parameterType="map" resultMap="BaseResultMap">
        select *
        from t_hkp_sys_user_user
        WHERE
        owner_dept_code in (${noticeDepts})
        AND is_deleted =FALSE
        <if test="excludeByPostCodes!=null">
            AND emp_post_code not in (${excludeByPostCodes})
        </if>
        <if test="excludeUserCodesByFocusCusCount!=null">
            AND user_code not in (${excludeUserCodesByFocusCusCount})
        </if>
        <if test="excludeUserCodesByNoticeUsers!=null">
            AND user_code not in(${excludeUserCodesByNoticeUsers})
        </if>
        <if test="excludeUserCodesByBlackList !=null">
            AND user_code not in (${excludeUserCodesByBlackList})
        </if>
    </select>

    <select id="excludeUserCodesByFocusCusCount" parameterType="map" resultType="string">
        SELECT
	    user_code
        FROM
	    t_hkp_crm_focus_cus
        WHERE
	        create_time BETWEEN #{createTimeStart}
            AND now()
            GROUP BY
	        user_code
            HAVING
	        COUNT (user_code) >= #{focusCusCount}
        UNION
        SELECT
	    user_code
        FROM
	    t_hkp_crm_focus_cus
        WHERE
            create_time BETWEEN #{oneDayCreateTimeStart}
            AND now()
            GROUP BY
            user_code
            HAVING
            COUNT (user_code) >= #{oneDayFocusCusCount}
    </select>
</mapper>
