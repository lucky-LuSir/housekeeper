<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">

    <resultMap id="BaseResultMap" type="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">
        <result column="ID" property="id" jdbcType="NUMERIC" javaType="long"/>

        <result column="apply_code" property="applyCode" jdbcType="VARCHAR"/>
        <result column="apply_status" property="applyStatus" jdbcType="VARCHAR"/>
        <result column="audit_reason" property="auditReason" jdbcType="VARCHAR"/>
        <result column="apply_reason" property="applyReason" jdbcType="VARCHAR"/>
        <result column="update_fields" property="updateFields" jdbcType="VARCHAR"/>
        <result column="update_content" property="updateContent" jdbcType="VARCHAR"/>

        <result column="order_code" property="orderCode" jdbcType="VARCHAR"/>
        <result column="order_time" property="orderTime" jdbcType="TIMESTAMP"/>
        <result column="order_status" property="orderStatus" jdbcType="VARCHAR"/>
        <result column="emp_code" property="empCode" jdbcType="VARCHAR"/>
        <result column="house_code" property="houseCode" jdbcType="VARCHAR"/>
        <result column="houseowner_phone" property="houseownerPhone" jdbcType="VARCHAR"/>
        <result column="cus_code" property="cusCode" jdbcType="VARCHAR"/>
        <result column="cus_phone" property="cusPhone" jdbcType="VARCHAR"/>
        <result column="acreage" property="acreage" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="price" property="price" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="unit" property="unit" jdbcType="VARCHAR"/>
        <result column="contract_start" property="contractStart" jdbcType="TIMESTAMP"/>
        <result column="contract_end" property="contractEnd" jdbcType="TIMESTAMP"/>
        <result column="month_count" property="monthCount" jdbcType="INTEGER"/>
        <result column="deposit" property="deposit" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="receivable_hos" property="receivableHos" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="receivable_cus" property="receivableCus" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="commission" property="commission" jdbcType="VARCHAR"/>

        <result column="cus_rebate" property="cusRebate" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="owner_rebate" property="ownerRebate" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="cus_parttime_money" property="cusParttimeMoney" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="owner_parttime_money" property="ownerParttimeMoney" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="actual_commision" property="actualCommision" jdbcType="NUMERIC"
                javaType="decimal"/>

        <result column="actual_branch_commision" property="actualBranchCommision" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="month_rent" property="monthRent" jdbcType="NUMERIC" javaType="decimal"/>

        <result column="cus_image_name" property="cusImageName" jdbcType="VARCHAR"/>
        <result column="cus_commission_num" property="cusCommissionNum" jdbcType="VARCHAR"/>
        <result column="owner_image_name" property="ownerImageName" jdbcType="VARCHAR"/>
        <result column="owner_commission_num" property="ownerCommissionNum" jdbcType="VARCHAR"/>
        <result column="expect_payment_time" property="expectPaymentTime" jdbcType="TIMESTAMP"/>


        <result column="emp_percentage_total" property="empPercentageTotal" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="emp_name" property="empName" jdbcType="VARCHAR"/>
        <result column="cus_name" property="cusName" jdbcType="VARCHAR"/>
        <result column="cus_sex" property="cusSex" jdbcType="VARCHAR"/>
        <result column="cus_emp_name" property="cusEmpName" jdbcType="VARCHAR"/>
        <result column="house_name" property="houseName" jdbcType="VARCHAR"/>
        <result column="hos_emp_name" property="hosEmpName" jdbcType="VARCHAR"/>
        <result column="province_name" property="provinceName" jdbcType="VARCHAR"/>
        <result column="city_name" property="cityName" jdbcType="VARCHAR"/>
        <result column="region_name" property="regionName" jdbcType="VARCHAR"/>
        <result column="street_name" property="streetName" jdbcType="VARCHAR"/>
        <result column="community_name" property="communityName" jdbcType="VARCHAR"/>
        <result column="detail_address" property="detailAddress" jdbcType="VARCHAR"/>

        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="cpy_code" property="cpyCode" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="last_update_time" property="lastUpdateTime" jdbcType="TIMESTAMP"/>
        <result column="create_code" property="createCode" jdbcType="VARCHAR"/>
        <result column="create_dept_code" property="createDeptCode" jdbcType="VARCHAR"/>
        <result column="last_update_code" property="lastUpdateCode" jdbcType="VARCHAR"/>
        <result column="is_deleted" property="isDeleted" jdbcType="BOOLEAN"/>

        <result column="create_dept_name" property="createDeptName" jdbcType="VARCHAR"/>
        <result column="par_dept_name" property="parDeptName" jdbcType="VARCHAR"/>
        <result column="leader_name" property="leaderName" jdbcType="VARCHAR"/>
        <result column="payback_sum" property="paybackSum" jdbcType="NUMERIC" javaType="decimal"/>
        <result column="iv_invoice_tax" property="ivInvoiceTax" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="house_type" property="houseType" jdbcType="VARCHAR"/>
        <result column="regio_name" property="regioName" jdbcType="VARCHAR"/>
        <result column="houseowner_type" property="houseownerType" jdbcType="VARCHAR"/>
        <result column="houseowner_name" property="houseownerName" jdbcType="VARCHAR"/>
        <result column="houseowner_company" property="houseownerCompany" jdbcType="VARCHAR"/>
        <result column="cus_company" property="cusCompany" jdbcType="VARCHAR"/>

        <result column="per_emp_name" property="perEmpName" jdbcType="VARCHAR"/>
        <result column="per_dept_name" property="perDeptName" jdbcType="VARCHAR"/>
        <result column="per_work_number" property="perWorkNumner" jdbcType="VARCHAR"/>

        <result column="per_percentage" property="perPercentage" jdbcType="NUMERIC"
                javaType="decimal"/>
        <result column="per_profit" property="perProfit" jdbcType="NUMERIC" javaType="decimal"/>

        <result column="has_commission_confirm" property="hasCommissionConfirm" jdbcType="BOOLEAN"/>

        <result column="update_type" property="updateType" jdbcType="VARCHAR"/>
        <result column="old_value" property="oldValue" jdbcType="VARCHAR"/>
        <result column="banlance" property="banlance" jdbcType="VARCHAR"/>
        <result column="new_value" property="newValue" jdbcType="VARCHAR"/>
        <result column="create_name" property="createName" jdbcType="VARCHAR"/>
        <result column="dept_code" property="deptCode" jdbcType="VARCHAR"/>
        <result column="dept_name" property="deptName" jdbcType="VARCHAR"/>
        <result column="last_update_name" property="lastUpdateName" jdbcType="VARCHAR"/>

        <collection property="orderPercentageApplyEntityList" columnPrefix="p_" javaType="java.util.ArrayList"
                    ofType="com.kfwy.hkp.trade.order.entity.OrderPercentageApplyEntity">
            <!--参与分成员工编码-->
            <result column="pe_emp_name" property="peEmpName" jdbcType="VARCHAR"/>
            <!--参与分成部门编码-->
            <result column="pe_dept_Name" property="peDeptName" jdbcType="VARCHAR"/>
            <!--员工工号-->
            <result column="work_number" property="workNumber" jdbcType="VARCHAR"/>

            <result column="pe_emp_code" property="peEmpCode" jdbcType="VARCHAR"/>
            <!--分成比例-->
            <result column="percentage" property="percentage" jdbcType="NUMERIC" javaType="decimal"/>
            <!--分成金额-->
            <result column="profit" property="profit" jdbcType="NUMERIC" javaType="decimal"/>
        </collection>
    </resultMap>

    <insert id="batchInsert" parameterType="java.util.List">
        <foreach collection="list" item="i" index="index" separator=";">
            INSERT INTO t_hkp_trade_order_update_apply
            <trim prefix="(" suffix=")" suffixOverrides=",">

                <if test="i.applyCode != null and i.applyCode != ''">
                    apply_code,
                </if>
                <if test="i.applyStatus != null">
                    apply_status,
                </if>
                <if test="i.auditReason != null and i.auditReason != ''">
                    audit_reason,
                </if>

                <if test="i.applyReason != null and i.applyReason != ''">
                    apply_reason,
                </if>
                <if test="i.updateFields != null  and i.updateFields != ''">
                    update_fields,
                </if>
                <if test="i.updateContent != null and i.updateContent != ''">
                    update_content,
                </if>

                <if test="i.orderCode != null and i.orderCode != ''">
                    order_code,
                </if>
                <if test="i.orderTime != null">
                    order_time,
                </if>
                <if test="i.orderStatus != null and i.orderStatus != ''">
                    order_status,
                </if>
                <if test="i.empCode != null and i.empCode != ''">
                    emp_code,
                </if>
                <if test="i.deptCode != null and i.deptCode != ''">
                    dept_code,
                </if>
                <if test="i.houseCode != null and i.houseCode != ''">
                    house_code,
                </if>
                <if test="i.houseownerPhone != null and i.houseownerPhone != ''">
                    houseowner_phone,
                </if>
                <if test="i.cusCode != null and i.cusCode != ''">
                    cus_code,
                </if>
                <if test="i.cusPhone != null and i.cusPhone != ''">
                    cus_phone,
                </if>
                <if test="i.acreage != null">
                    acreage,
                </if>
                <if test="i.price != null">
                    price,
                </if>
                <if test="i.unit != null and i.unit != ''">
                    unit,
                </if>
                <if test="i.contractStart != null">
                    contract_start,
                </if>
                <if test="i.contractEnd != null">
                    contract_end,
                </if>
                <if test="i.monthCount != null">
                    month_count,
                </if>
                <if test="i.deposit != null">
                    deposit,
                </if>
                <if test="i.receivableHos != null">
                    receivable_hos,
                </if>
                <if test="i.receivableCus != null">
                    receivable_cus,
                </if>

                /*0928add*/
                <if test="i.cusRebate != null">
                    cus_rebate,
                </if>

                <if test="i.ownerRebate != null">
                    owner_rebate,
                </if>
                <if test="i.cusParttimeMoney != null">
                    cus_parttime_money,
                </if>
                <if test="i.ownerParttimeMoney != null">
                    owner_parttime_money,
                </if>
                <if test="i.actualCommision != null">
                    actual_commision,
                </if>
                <if test="i.actualBranchCommision != null">
                    actual_branch_commision,
                </if>
                <if test="i.monthRent != null">
                    month_rent,
                </if>

                <if test="i.cusImageName != null and i.cusImageName != ''">
                    cus_image_name,
                </if>
                <if test="i.cusCommissionNum != null and i.cusCommissionNum != ''">
                    cus_commission_num,
                </if>
                <if test="i.ownerImageName != null and i.ownerImageName != ''">
                    owner_image_name,
                </if>
                <if test="i.ownerCommissionNum != null and i.ownerCommissionNum != ''">
                    owner_commission_num,
                </if>
                <if test="i.expectPaymentTime != null">
                    expect_payment_time,
                </if>

                <if test="i.commission != null and i.commission != ''">
                    commission,
                </if>

                <if test="i.remark != null and i.remark != ''">
                    remark,
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    cpy_code,
                </if>
                <if test="i.createTime != null">
                    create_time,
                </if>
                <if test="i.lastUpdateTime != null">
                    last_update_time,
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    create_code,
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    create_dept_code,
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    last_update_code,
                </if>
                <if test="i.isDeleted != null">
                    is_deleted,
                </if>
            </trim>
            <trim prefix="values (" suffix=")" suffixOverrides=",">
                <if test="i.applyCode != null and i.applyCode != ''">
                    #{i.applyCode},
                </if>
                <if test="i.applyStatus != null">
                    #{i.applyStatus},
                </if>
                <if test="i.auditReason != null and i.auditReason != ''">
                    #{i.auditReason},
                </if>

                <if test="i.applyReason != null and i.applyReason != ''">
                    #{i.applyReason},
                </if>
                <if test="i.updateFields != null and i.updateFields != ''">
                    #{i.updateFields},
                </if>
                <if test="i.updateContent != null and i.updateContent != ''">
                    #{i.updateContent},
                </if>
                <if test="i.orderCode != null and i.orderCode != ''">
                    #{i.orderCode},
                </if>
                <if test="i.orderTime != null">
                    #{i.orderTime},
                </if>
                <if test="i.orderStatus != null and i.orderStatus != ''">
                    #{i.orderStatus},
                </if>
                <if test="i.empCode != null and i.empCode != ''">
                    #{i.empCode},
                </if>
                <if test="i.deptCode != null and i.deptCode != ''">
                    #{i.deptCode},
                </if>
                <if test="i.houseCode != null and i.houseCode != ''">
                    #{i.houseCode},
                </if>
                <if test="i.houseownerPhone != null and i.houseownerPhone != ''">
                    #{i.houseownerPhone},
                </if>
                <if test="i.cusCode != null and i.cusCode != ''">
                    #{i.cusCode},
                </if>
                <if test="i.cusPhone != null and i.cusPhone != ''">
                    #{i.cusPhone},
                </if>
                <if test="i.acreage != null">
                    #{i.acreage},
                </if>
                <if test="i.price != null">
                    #{i.price},
                </if>
                <if test="i.unit != null and i.unit != ''">
                    #{i.unit},
                </if>
                <if test="i.contractStart != null">
                    #{i.contractStart},
                </if>
                <if test="i.contractEnd != null">
                    #{i.contractEnd},
                </if>
                <if test="i.monthCount != null">
                    #{i.monthCount},
                </if>
                <if test="i.deposit != null">
                    #{i.deposit},
                </if>
                <if test="i.receivableHos != null">
                    #{i.receivableHos},
                </if>
                <if test="i.receivableCus != null">
                    #{i.receivableCus},
                </if>

                /*0928add*/
                <if test="i.cusRebate != null">
                    #{i.cusRebate},
                </if>
                <if test="i.ownerRebate != null">
                    #{i.ownerRebate},
                </if>
                <if test="i.cusParttimeMoney != null">
                    #{i.cusParttimeMoney},
                </if>
                <if test="i.ownerParttimeMoney != null">
                    #{i.ownerParttimeMoney},
                </if>
                <if test="i.actualCommision != null">
                    #{i.actualCommision},
                </if>
                <if test="i.actualBranchCommision != null">
                    #{i.actualBranchCommision},
                </if>
                <if test="i.monthRent != null">
                    #{i.monthRent},
                </if>

                <if test="i.cusImageName != null and i.cusImageName != ''">
                    #{i.cusImageName},
                </if>
                <if test="i.cusCommissionNum != null and i.cusCommissionNum != ''">
                    #{i.cusCommissionNum},
                </if>
                <if test="i.ownerImageName != null and i.ownerImageName != ''">
                    #{i.ownerImageName},
                </if>
                <if test="i.ownerCommissionNum != null and i.ownerCommissionNum != ''">
                    #{i.ownerCommissionNum},
                </if>
                <if test="i.expectPaymentTime != null">
                    #{i.expectPaymentTime},
                </if>


                <if test="i.commission != null and i.commission != ''">
                    #{i.commission},
                </if>

                <if test="i.remark != null and i.remark != ''">
                    #{i.remark},
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    #{i.cpyCode},
                </if>
                <if test="i.createTime != null">
                    #{i.createTime},
                </if>
                <if test="i.lastUpdateTime != null">
                    #{i.lastUpdateTime},
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    #{i.createCode},
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    #{i.createDeptCode},
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    #{i.lastUpdateCode},
                </if>
                <if test="i.isDeleted != null">
                    #{i.isDeleted},
                </if>
            </trim>
        </foreach>
    </insert>

    <!-- 批量更新记录 -->
    <update id="batchUpdate" parameterType="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">
        <foreach collection="list" item="i" index="index" separator=";">
            update t_hkp_trade_order_update_apply
            <trim prefix="set" suffixOverrides=",">

                <if test="i.applyCode != null and i.applyCode != ''">
                    apply_code=#{i.applyCode},
                </if>

                <if test="i.applyStatus != null">
                    apply_status=#{i.applyStatus},
                </if>
                <if test="i.auditReason != null and i.auditReason != ''">
                    audit_reason=#{i.auditReason},
                </if>

                <if test="i.applyReason != null and i.applyReason != ''">
                    apply_reason = #{i.applyReason},
                </if>
                <if test="i.updateFields != null and i.updateFields != ''">
                    update_fields = #{i.updateFields},
                </if>
                <if test="i.updateContent != null and i.updateContent != ''">
                    update_content = #{i.updateContent},
                </if>

                <if test="i.orderCode != null and i.orderCode != ''">
                    order_code=#{i.orderCode},
                </if>
                <if test="i.orderTime != null">
                    order_time=#{i.orderTime},
                </if>
                <if test="i.orderStatus != null and i.orderStatus != ''">
                    order_status=#{i.orderStatus},
                </if>
                <if test="i.empCode != null and i.empCode != ''">
                    emp_code=#{i.empCode},
                </if>
                <if test="i.deptCode != null and i.deptCode != ''">
                    dept_code=#{i.deptCode},
                </if>
                <if test="i.houseCode != null and i.houseCode != ''">
                    house_code=#{i.houseCode},
                </if>
                <if test="i.houseownerPhone != null and i.houseownerPhone != ''">
                    houseowner_phone=#{i.houseownerPhone},
                </if>
                <if test="i.cusCode != null and i.cusCode != ''">
                    cus_code=#{i.cusCode},
                </if>
                <if test="i.cusPhone != null and i.cusPhone != ''">
                    cus_phone=#{i.cusPhone},
                </if>
                <if test="i.acreage != null">
                    acreage=#{i.acreage},
                </if>
                <if test="i.price != null">
                    price=#{i.price},
                </if>
                <if test="i.unit != null and i.unit != ''">
                    unit=#{i.unit},
                </if>
                <if test="i.contractStart != null">
                    contract_start=#{i.contractStart},
                </if>
                <if test="i.contractEnd != null">
                    contract_end=#{i.contractEnd},
                </if>
                <if test="i.monthCount != null">
                    month_count=#{i.monthCount},
                </if>
                <if test="i.deposit != null">
                    deposit=#{i.deposit},
                </if>
                <if test="i.receivableHos != null">
                    receivable_hos=#{i.receivableHos},
                </if>
                <if test="i.receivableCus != null">
                    receivable_cus=#{i.receivableCus},
                </if>

                /*0928add*/
                <if test="i.cusRebate != null">
                    cus_rebate=#{i.cusRebate},
                </if>

                <if test="i.ownerRebate != null">
                    owner_rebate=#{i.ownerRebate},
                </if>
                <if test="i.cusParttimeMoney != null">
                    cus_parttime_money=#{i.cusParttimeMoney},
                </if>
                <if test="i.ownerParttimeMoney != null">
                    owner_parttime_money=#{i.ownerParttimeMoney},
                </if>
                <if test="i.actualCommision != null">
                    actual_commision=#{i.actualCommision},
                </if>
                <if test="i.actualBranchCommision != null">
                    actual_branch_commision=#{i.actualBranchCommision},
                </if>
                <if test="i.monthRent != null">
                    month_rent=#{i.monthRent},
                </if>

                <if test="i.cusImageName != null and i.cusImageName != ''">
                    cus_image_name=#{i.cusImageName},
                </if>
                <if test="i.cusCommissionNum != null and i.cusCommissionNum != ''">
                    cus_commission_num=#{i.cusCommissionNum},
                </if>
                <if test="i.ownerImageName != null and i.ownerImageName != ''">
                    owner_image_name=#{i.ownerImageName},
                </if>
                <if test="i.ownerCommissionNum != null and i.ownerCommissionNum != ''">
                    owner_commission_num=#{i.ownerCommissionNum},
                </if>
                <if test="i.expectPaymentTime != null">
                    expect_payment_time=#{i.expectPaymentTime},
                </if>


                <if test="i.commission != null and i.commission != ''">
                    commission=#{i.commission},
                </if>

                <if test="i.remark != null and i.remark != ''">
                    remark=#{i.remark},
                </if>
                <if test="i.cpyCode != null and i.cpyCode != ''">
                    cpy_code=#{i.cpyCode},
                </if>
                <if test="i.createTime != null">
                    create_time=#{i.createTime},
                </if>
                <if test="i.lastUpdateTime != null">
                    last_update_time=#{i.lastUpdateTime},
                </if>
                <if test="i.createCode != null and i.createCode != ''">
                    create_code=#{i.createCode},
                </if>
                <if test="i.createDeptCode != null and i.createDeptCode != ''">
                    create_dept_code=#{i.createDeptCode},
                </if>
                <if test="i.lastUpdateCode != null and i.lastUpdateCode != ''">
                    last_update_code=#{i.lastUpdateCode},
                </if>
                <if test="i.isDeleted != null">
                    is_deleted=#{i.isDeleted},
                </if>
                <if test="i.hasCommissionConfirm != null and i.hasCommissionConfirm != ''">
                    has_commission_confirm =#{i.hasCommissionConfirm}
                </if>
            </trim>
            <trim prefix="where" prefixOverrides="and|or">
                <if test="i.id != null">
                    and id = #{i.id}
                </if>
                <if test="i.orderCode != null">
                    and order_code = #{i.orderCode}
                </if>
                <if test="i.applyCode != null">
                    and apply_code = #{i.applyCode}
                </if>
            </trim>
        </foreach>
    </update>

    <!--执行本地更新 -->
    <update id="updateByNativeSql" parameterType="string">
        ${value}
    </update>

    <sql id="selectSql">
        <trim prefix="where" prefixOverrides="AND|OR">
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="applyCode != null and applyCode != ''">
                AND apply_code = #{applyCode}
            </if>

            <if test="applyStatus != null">
                AND apply_status = #{applyStatus}
            </if>
            <if test="auditReason != null and auditReason != ''">
                AND audit_reason = #{auditReason}
            </if>
            <if test="orderCode != null and orderCode != ''">
                AND order_code = #{orderCode}
            </if>
            <if test="orderStatus != null and orderStatus != ''">
                AND order_status = #{orderStatus}
            </if>
            <if test="noOrderStatuses != null">
                <choose>
                    <when test="_noOrderStatuses">
                        AND order_status NOT IN (${_noOrderStatuses})
                    </when>
                    <otherwise>
                        AND order_status NOT IN
                        <foreach collection="noOrderStatuses" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="empCode != null and empCode != ''">
                AND emp_code = #{empCode}
            </if>
            <if test="houseCode != null and houseCode != ''">
                AND house_code = #{houseCode}
            </if>
            <if test="cusCode != null and cusCode != ''">
                AND cus_code = #{cusCode}
            </if>
            <if test="cusPhone != null and cusPhone != ''">
                AND cus_phone = #{cusPhone}
            </if>
            <if test="houseownerPhone != null and houseownerPhone != ''">
                AND houseowner_phone = #{houseownerPhone}
            </if>
            <choose>
                <when test="community !=null and community!=''">
                    AND community=#{community}
                </when>
                <when test="street !=null and street!=''">
                    AND street=#{street}
                </when>
                <when test="region != null and region!=''">
                    AND region = #{region}
                </when>
                <when test="city != null and city!=''">
                    AND city = #{city}
                </when>
                <when test="province != null and province!=''">
                    AND province =#{province}
                </when>
            </choose>
            <if test="address != null and address != ''">
                AND (location_alias like '%' || #{address} || '%' or detail_address like '%' ||
                #{address} || '%')
            </if>
            <if test="houseName != null and houseName != ''">
                AND house_name like '%' || #{houseName} || '%'
            </if>
            <if test="acreageStart != null and acreageStart != ''">
                AND acreage <![CDATA[ >= ]]> #{acreageStart}
            </if>
            <if test="acreageEnd != null and acreageEnd != ''">
                AND acreage <![CDATA[ <= ]]> #{acreageEnd}
            </if>

            <if test="cpyCode != null and cpyCode != ''">
                AND cpy_code = #{cpyCode}
            </if>
            <if test="createCode != null and createCode!=''">
                AND create_code = #{createCode}
            </if>
            <if test="createDeptCode != null and createDeptCode!=''">
                AND dept_code = #{createDeptCode}
            </if>
            <if test="createTimeStart != null">
                AND create_time <![CDATA[ >= ]]> #{createTimeStart}
            </if>
            <if test="createDeptCodes != null">
                <choose>
                    <when test="_createDeptCodes != null">
                        AND dept_code IN (${_createDeptCodes})
                    </when>
                    <otherwise>
                        AND dept_code IN
                        <foreach collection="createDeptCodes" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="empCodes != null">
                <choose>
                    <when test="_empCodes != null">
                        AND emp_code IN (${_empCodes})
                    </when>
                    <otherwise>
                        AND emp_code IN
                        <foreach collection="empCodes" item="i" open="(" separator=","
                                 close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="createCodes != null">
                <choose>
                    <when test="_createCodes != null">
                        AND create_code IN (${_createCodes})
                    </when>
                    <otherwise>
                        AND create_code IN
                        <foreach collection="createCodes" item="i" open="(" separator="," close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="createTimeEnd != null">
                AND create_time <![CDATA[ <= ]]> #{createTimeEnd}
            </if>
            <if test="orderTimeStart != null">
                AND order_time <![CDATA[ >= ]]> #{orderTimeStart}
            </if>
            <if test="orderTimeEnd != null">
                AND order_time <![CDATA[ <= ]]> #{orderTimeEnd}
            </if>
            <if test="isDeleted != null">
                AND is_deleted=#{isDeleted}
            </if>
            <if test="deptCodes != null">
                <choose>
                    <when test="_deptCodes != null and _deptCodes != ''">
                        AND dept_code IN (${_deptCodes})
                    </when>
                    <otherwise>
                        AND dept_code IN
                        <foreach collection="deptCodes" item="i" open="(" separator="," close=")">
                            #{i}
                        </foreach>
                    </otherwise>
                </choose>
            </if>
            <if test="deptCode != null and deptCode != ''">
                AND dept_code = #{deptCode}
            </if>
            <if test="keyword != null and keyword!=''">
                AND (
                order_code like '%' || #{keyword} ||'%'
                or house_code like '%' || #{keyword} ||'%'
                or cus_code like '%' || #{keyword} ||'%'
                or cus_phone like '%' || #{keyword} ||'%'
                )
            </if>
            <if test="empName !=null and empName!=''">
                AND emp_name=#{empName}
            </if>
            <if test="createDeptName !=null and createDeptName!=''">
                AND create_dept_name like '%' || #{createDeptName} ||'%'
            </if>
        </trim>
    </sql>


    <!-- 查询符合条件的唯一记录 -->
    <select id="selectUniqueByProp" parameterType="map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">
        select * from t_hkp_trade_order_update_apply
        <include refid="selectSql"></include>
    </select>

    <!-- 查询订单的详情-->
    <select id="detail" parameterType="string" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">
        SELECT
            o.*,
            c.cus_name,
            c.cus_sex,
            c.cus_phone,
            h.house_name,
            e.user_name  AS emp_name,
            e1.user_name AS cus_emp_name,
            e2.user_name AS hos_emp_name
        FROM t_hkp_trade_order_update_apply o
            LEFT JOIN t_hkp_crm_customer c ON o.cus_code = c.cus_code
            LEFT JOIN t_hkp_hos_house h ON o.house_code = h.house_code
            LEFT JOIN t_hkp_sys_user_user e ON e.user_code = o.emp_code
            LEFT JOIN t_hkp_sys_user_user e1 ON e1.user_code = c.emp_code
            LEFT JOIN t_hkp_sys_user_user e2 ON e2.user_code = h.emp_code
        WHERE o.order_code = #{orderCode}
    </select>

    <!-- 查询符合条件的实体对象 -->
    <select id="selectByMap" parameterType="map" resultMap="BaseResultMap"
            resultType="com.kfwy.hkp.trade.order.entity.OrderUpdateApplyEntity">
        select TP.*,
        (SELECT sum(percentage) FROM t_hkp_trade_order_percentage_apply
        where order_code = TP.order_code and pe_emp_code = #{empPercentageCode})
        emp_percentage_total
        from
        (
        SELECT
        o.*,
        us.user_name as emp_name,
        us.owner_dept_name as create_dept_name,
        usr.user_name as last_update_name,
        dept.dept_name as dept_name,
        h.house_name,h.province,h.city,h.region,h.street,h.community,
        h.province_name,h.city_name,h.region_name,h.street_name,h.community_name,
        l.location_alias,l.detail_address
        FROM
        <choose>
            <when test="peEmpCode != null">
                (SELECT * from t_hkp_trade_order_update_apply cs
                where order_code IN (
                SELECT a.order_code from t_hkp_trade_order_percentage_apply a
                where a.order_code = cs.order_code and pe_emp_code = #{peEmpCode}) ) o
            </when>
            <otherwise>
                t_hkp_trade_order_update_apply o
            </otherwise>
        </choose>
        LEFT JOIN t_hkp_hos_house h on o.house_code = h.house_code
        LEFT JOIN t_hkp_hos_location l on l.location_code = h.location_code
        LEFT JOIN t_hkp_sys_user_user us ON us.user_code=o.emp_code
        LEFT JOIN t_hkp_sys_user_user usr on usr.user_code=o.last_update_code
        left join t_hkp_hrm_org_dept dept on dept.dept_code=o.dept_code
        ) TP
        <include refid="selectSql"></include>
        <if test="orderBy != null and orderBy != ''">
            ORDER BY ${orderBy}
        </if>
        <if test="order != null and order != ''">
            ${order}
        </if>
    </select>

    <!-- 统计符合条件的实体对象个数 -->
    <select id="selectByMapCount" parameterType="map" resultType="int">
        select count(*) from (
        SELECT
        o.*,
        us.user_name as emp_name,
        us.owner_dept_name as create_dept_name,
        usr.user_name as last_update_name,
        dept.dept_name as dept_name,
        h.house_name,h.province,h.city,h.region,h.street,h.community,
        h.province_name,h.city_name,h.region_name,h.street_name,h.community_name,
        l.location_alias,l.detail_address
        FROM
        <choose>
            <when test="peEmpCode != null">
                (SELECT * from t_hkp_trade_order_update_apply cs
                where order_code IN (
                SELECT a.order_code from t_hkp_trade_order_percentage_apply a
                where a.order_code = cs.order_code and pe_emp_code = #{peEmpCode}) ) o
            </when>
            <otherwise>
                t_hkp_trade_order_update_apply o
            </otherwise>
        </choose>
        LEFT JOIN t_hkp_hos_house h on o.house_code = h.house_code
        LEFT JOIN t_hkp_hos_location l on l.location_code = h.location_code
        LEFT JOIN t_hkp_sys_user_user us ON us.user_code=o.emp_code
        LEFT JOIN t_hkp_sys_user_user usr on usr.user_code=o.last_update_code
        left join t_hkp_hrm_org_dept dept on dept.dept_code=o.dept_code

        ) TP
        <include refid="selectSql"/>
    </select>



</mapper>
